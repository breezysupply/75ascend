---
import Layout from '../layouts/Layout.astro';
import Dashboard from '../components/Dashboard';
import { initializeApp } from '../utils/amplifyConfig';

// Initialize Amplify (this will be a no-op in development)
initializeApp();

// This check will happen client-side since Astro runs on the server
// and Auth needs to run in the browser
---

<Layout title="75 ASCEND">
  <Dashboard client:load />
  
  <script>
    // Check if we're in development mode
    const isDevelopment = import.meta.env.DEV || process.env.NODE_ENV === 'development';
    
    if (!isDevelopment) {
      // In production, check authentication
      import('aws-amplify/auth').then(({ fetchAuthSession }) => {
        fetchAuthSession().then(session => {
          if (!session.tokens) {
            window.location.href = '/login';
          }
        }).catch(() => {
          window.location.href = '/login';
        });
      });
    } else {
      console.log('Development mode: Skipping authentication check');
    }
  </script>
</Layout> 